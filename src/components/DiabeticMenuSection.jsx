import React, { useState, useEffect } from 'react';

const DiabeticMenuSection = ({ dishes = [] }) => {
  const [filteredDishes, setFilteredDishes] = useState([]);
  const [sortBy, setSortBy] = useState('gi'); // gi, calories, protein
  const [filterBy, setFilterBy] = useState('all'); // all, low-gi, high-protein, low-calories

  useEffect(() => {
    let filtered = dishes.filter(dish => dish.diabeticFriendly === true);
    
    // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è
    switch (filterBy) {
      case 'low-gi':
        filtered = filtered.filter(dish => dish.glycemicIndex < 50);
        break;
      case 'high-protein':
        filtered = filtered.filter(dish => dish.protein > 15);
        break;
      case 'low-calories':
        filtered = filtered.filter(dish => dish.calories < 300);
        break;
      default:
        break;
    }

    // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞
    switch (sortBy) {
      case 'gi':
        filtered.sort((a, b) => (a.glycemicIndex || 0) - (b.glycemicIndex || 0));
        break;
      case 'calories':
        filtered.sort((a, b) => (a.calories || 0) - (b.calories || 0));
        break;
      case 'protein':
        filtered.sort((a, b) => (b.protein || 0) - (a.protein || 0));
        break;
      default:
        break;
    }

    setFilteredDishes(filtered);
  }, [dishes, sortBy, filterBy]);

  const getGIColor = (gi) => {
    if (gi < 50) return '#4caf50'; // –ó–µ–ª–µ–Ω—ã–π - –Ω–∏–∑–∫–∏–π –ì–ò
    if (gi < 70) return '#ff9800'; // –û—Ä–∞–Ω–∂–µ–≤—ã–π - —Å—Ä–µ–¥–Ω–∏–π –ì–ò
    return '#f44336'; // –ö—Ä–∞—Å–Ω—ã–π - –≤—ã—Å–æ–∫–∏–π –ì–ò
  };

  const getGILabel = (gi) => {
    if (gi < 50) return '–ù–∏–∑–∫–∏–π –ì–ò';
    if (gi < 70) return '–°—Ä–µ–¥–Ω–∏–π –ì–ò';
    return '–í—ã—Å–æ–∫–∏–π –ì–ò';
  };

  return (
    <div style={{ padding: '20px' }}>
      {/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å–µ–∫—Ü–∏–∏ */}
      <div style={{
        textAlign: 'center',
        marginBottom: '30px',
        padding: '20px',
        backgroundColor: '#e8f5e8',
        borderRadius: '12px',
        border: '2px solid #4caf50'
      }}>
        <div style={{ fontSize: '24px', fontWeight: 'bold', color: '#2e7d32', marginBottom: '10px' }}>
          ü©∫ –ú–µ–Ω—é –¥–ª—è –¥–∏–∞–±–µ—Ç–∏–∫–æ–≤
        </div>
        <div style={{ fontSize: '14px', color: '#666' }}>
          –í—Å–µ –±–ª—é–¥–∞ –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã AI-—Å–∏—Å—Ç–µ–º–æ–π –∏ –ø–æ–¥—Ö–æ–¥—è—Ç –¥–ª—è –ª—é–¥–µ–π —Å –¥–∏–∞–±–µ—Ç–æ–º
        </div>
        <div style={{ fontSize: '12px', color: '#4caf50', marginTop: '5px' }}>
          ‚úÖ –ë–µ–∑ —Å–∞—Ö–∞—Ä–∞ ‚Ä¢ ‚úÖ –ù–∏–∑–∫–∏–π –ì–ò ‚Ä¢ ‚úÖ –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ —ç–∫—Å–ø–µ—Ä—Ç–∞–º–∏
        </div>
      </div>

      {/* –§–∏–ª—å—Ç—Ä—ã –∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ */}
      <div style={{
        display: 'flex',
        gap: '15px',
        marginBottom: '20px',
        flexWrap: 'wrap',
        alignItems: 'center'
      }}>
        <div>
          <label style={{ marginRight: '5px', fontWeight: 'bold' }}>–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞:</label>
          <select
            value={sortBy}
            onChange={(e) => setSortBy(e.target.value)}
            style={{
              padding: '5px 10px',
              borderRadius: '4px',
              border: '1px solid #ddd'
            }}
          >
            <option value="gi">–ü–æ –≥–ª–∏–∫–µ–º–∏—á–µ—Å–∫–æ–º—É –∏–Ω–¥–µ–∫—Å—É</option>
            <option value="calories">–ü–æ –∫–∞–ª–æ—Ä–∏—è–º</option>
            <option value="protein">–ü–æ –±–µ–ª–∫—É</option>
          </select>
        </div>

        <div>
          <label style={{ marginRight: '5px', fontWeight: 'bold' }}>–§–∏–ª—å—Ç—Ä:</label>
          <select
            value={filterBy}
            onChange={(e) => setFilterBy(e.target.value)}
            style={{
              padding: '5px 10px',
              borderRadius: '4px',
              border: '1px solid #ddd'
            }}
          >
            <option value="all">–í—Å–µ –±–ª—é–¥–∞</option>
            <option value="low-gi">–ù–∏–∑–∫–∏–π –ì–ò (&lt;50)</option>
            <option value="high-protein">–í—ã—Å–æ–∫–æ–±–µ–ª–∫–æ–≤—ã–µ (&gt;15–≥)</option>
            <option value="low-calories">–ù–∏–∑–∫–æ–∫–∞–ª–æ—Ä–∏–π–Ω—ã–µ (&lt;300 –∫–∫–∞–ª)</option>
          </select>
        </div>

        <div style={{
          fontSize: '12px',
          color: '#666',
          marginLeft: 'auto'
        }}>
          –ù–∞–π–¥–µ–Ω–æ: {filteredDishes.length} –±–ª—é–¥
        </div>
      </div>

      {/* –°–ø–∏—Å–æ–∫ –±–ª—é–¥ */}
      {filteredDishes.length === 0 ? (
        <div style={{
          textAlign: 'center',
          padding: '40px',
          color: '#666',
          fontSize: '16px'
        }}>
          <div style={{ fontSize: '48px', marginBottom: '10px' }}>üçΩÔ∏è</div>
          <div>–ü–æ–∫–∞ –Ω–µ—Ç –±–ª—é–¥ –¥–ª—è –¥–∏–∞–±–µ—Ç–∏–∫–æ–≤</div>
          <div style={{ fontSize: '12px', marginTop: '5px' }}>
            –ü–æ–≤–∞—Ä–∞ –¥–æ–±–∞–≤–ª—è—é—Ç –Ω–æ–≤—ã–µ –±–ª—é–¥–∞ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å
          </div>
        </div>
      ) : (
        <div style={{
          display: 'grid',
          gridTemplateColumns: 'repeat(auto-fill, minmax(300px, 1fr))',
          gap: '20px'
        }}>
          {filteredDishes.map((dish, index) => (
            <div key={index} style={{
              border: '2px solid #4caf50',
              borderRadius: '12px',
              padding: '15px',
              backgroundColor: '#f8fff8',
              transition: 'transform 0.2s ease',
              cursor: 'pointer'
            }}
            onMouseEnter={(e) => e.target.style.transform = 'translateY(-2px)'}
            onMouseLeave={(e) => e.target.style.transform = 'translateY(0)'}
            >
              {/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ –±–ª—é–¥–∞ */}
              <div style={{
                fontSize: '18px',
                fontWeight: 'bold',
                marginBottom: '10px',
                color: '#2e7d32'
              }}>
                {dish.name}
              </div>

              {/* –§–æ—Ç–æ –±–ª—é–¥–∞ */}
              {dish.image && (
                <div style={{
                  width: '100%',
                  height: '150px',
                  backgroundColor: '#f0f0f0',
                  borderRadius: '8px',
                  marginBottom: '10px',
                  backgroundImage: `url(${dish.image})`,
                  backgroundSize: 'cover',
                  backgroundPosition: 'center'
                }} />
              )}

              {/* –ü–∏—â–µ–≤–∞—è —Ü–µ–Ω–Ω–æ—Å—Ç—å */}
              <div style={{
                display: 'grid',
                gridTemplateColumns: '1fr 1fr',
                gap: '8px',
                marginBottom: '10px',
                fontSize: '12px'
              }}>
                <div>
                  <span style={{ fontWeight: 'bold' }}>–ö–∞–ª–æ—Ä–∏–∏:</span> {dish.calories || 0} –∫–∫–∞–ª
                </div>
                <div>
                  <span style={{ fontWeight: 'bold' }}>–ë–µ–ª–∫–∏:</span> {dish.protein || 0}–≥
                </div>
                <div>
                  <span style={{ fontWeight: 'bold' }}>–£–≥–ª–µ–≤–æ–¥—ã:</span> {dish.carbs || 0}–≥
                </div>
                <div>
                  <span style={{ fontWeight: 'bold' }}>–ñ–∏—Ä—ã:</span> {dish.fat || 0}–≥
                </div>
              </div>

              {/* –ì–ª–∏–∫–µ–º–∏—á–µ—Å–∫–∏–π –∏–Ω–¥–µ–∫—Å */}
              <div style={{
                display: 'flex',
                alignItems: 'center',
                marginBottom: '10px',
                padding: '5px 10px',
                backgroundColor: getGIColor(dish.glycemicIndex || 0),
                borderRadius: '15px',
                color: 'white',
                fontSize: '12px',
                fontWeight: 'bold'
              }}>
                <span style={{ marginRight: '5px' }}>üìä</span>
                –ì–ò: {dish.glycemicIndex || 0} ({getGILabel(dish.glycemicIndex || 0)})
              </div>

              {/* –ú–µ—Ç–∫–∏ */}
              <div style={{
                display: 'flex',
                flexWrap: 'wrap',
                gap: '5px',
                marginBottom: '10px'
              }}>
                <span style={{
                  padding: '2px 8px',
                  backgroundColor: '#4caf50',
                  color: 'white',
                  borderRadius: '10px',
                  fontSize: '10px',
                  fontWeight: 'bold'
                }}>
                  ‚úÖ –ë–µ–∑ —Å–∞—Ö–∞—Ä–∞
                </span>
                <span style={{
                  padding: '2px 8px',
                  backgroundColor: '#2196f3',
                  color: 'white',
                  borderRadius: '10px',
                  fontSize: '10px',
                  fontWeight: 'bold'
                }}>
                  ü©∫ –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ
                </span>
                {dish.halal && (
                  <span style={{
                    padding: '2px 8px',
                    backgroundColor: '#9c27b0',
                    color: 'white',
                    borderRadius: '10px',
                    fontSize: '10px',
                    fontWeight: 'bold'
                  }}>
                    üïå –•–∞–ª—è–ª—å
                  </span>
                )}
              </div>

              {/* –û–ø–∏—Å–∞–Ω–∏–µ */}
              {dish.description && (
                <div style={{
                  fontSize: '12px',
                  color: '#666',
                  marginBottom: '10px',
                  lineHeight: '1.4'
                }}>
                  {dish.description}
                </div>
              )}

              {/* AI-—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è */}
              <div style={{
                fontSize: '11px',
                color: '#1976d2',
                backgroundColor: '#e3f2fd',
                padding: '8px',
                borderRadius: '6px',
                borderLeft: '3px solid #2196f3'
              }}>
                <div style={{ fontWeight: 'bold', marginBottom: '3px' }}>ü§ñ AI-—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:</div>
                <div>
                  {dish.glycemicIndex < 50 
                    ? '–û—Ç–ª–∏—á–Ω–æ –¥–ª—è –¥–∏–∞–±–µ—Ç–∏–∫–æ–≤! –ù–∏–∑–∫–∏–π –ì–ò –∏ —Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–æ—Å—Ç–∞–≤.'
                    : dish.glycemicIndex < 70
                    ? '–ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –¥–∏–∞–±–µ—Ç–∏–∫–æ–≤ –≤ —É–º–µ—Ä–µ–Ω–Ω—ã—Ö –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞—Ö.'
                    : '–¢—Ä–µ–±—É–µ—Ç –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ—Å—Ç–∏ –ø—Ä–∏ –¥–∏–∞–±–µ—Ç–µ.'
                  }
                </div>
              </div>

              {/* –ö–Ω–æ–ø–∫–∞ –∑–∞–∫–∞–∑–∞ */}
              <button style={{
                width: '100%',
                padding: '10px',
                backgroundColor: '#4caf50',
                color: 'white',
                border: 'none',
                borderRadius: '6px',
                fontSize: '14px',
                fontWeight: 'bold',
                cursor: 'pointer',
                marginTop: '10px',
                transition: 'background-color 0.2s ease'
              }}
              onMouseEnter={(e) => e.target.style.backgroundColor = '#45a049'}
              onMouseLeave={(e) => e.target.style.backgroundColor = '#4caf50'}
              >
                üõí –ó–∞–∫–∞–∑–∞—Ç—å –∑–∞ {dish.price || '0'}‚ÇΩ
              </button>
            </div>
          ))}
        </div>
      )}

      {/* –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–π –±–ª–æ–∫ */}
      <div style={{
        marginTop: '30px',
        padding: '20px',
        backgroundColor: '#f5f5f5',
        borderRadius: '8px',
        fontSize: '12px',
        color: '#666'
      }}>
        <div style={{ fontWeight: 'bold', marginBottom: '10px', color: '#333' }}>
          ‚ÑπÔ∏è –û –¥–∏–∞–±–µ—Ç–∏—á–µ—Å–∫–æ–º –º–µ–Ω—é
        </div>
        <div style={{ lineHeight: '1.5' }}>
          –í—Å–µ –±–ª—é–¥–∞ –≤ —ç—Ç–æ–º —Ä–∞–∑–¥–µ–ª–µ –ø—Ä–æ—à–ª–∏ –ø—Ä–æ–≤–µ—Ä–∫—É AI-—Å–∏—Å—Ç–µ–º–æ–π –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º –¥–ª—è –ª—é–¥–µ–π —Å –¥–∏–∞–±–µ—Ç–æ–º.
          –ú—ã –ø—Ä–æ–≤–µ—Ä—è–µ–º –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Å–∞—Ö–∞—Ä–∞, –Ω–∏–∑–∫–∏–π –≥–ª–∏–∫–µ–º–∏—á–µ—Å–∫–∏–π –∏–Ω–¥–µ–∫—Å –∏ —Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–æ—Å—Ç–∞–≤.
          –ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –≤–æ–ø—Ä–æ—Å—ã –æ —Å–æ—Å—Ç–∞–≤–µ –±–ª—é–¥–∞, –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –ø–æ–≤–∞—Ä—É —á–µ—Ä–µ–∑ —á–∞—Ç.
        </div>
      </div>
    </div>
  );
};

export default DiabeticMenuSection;
